(this["webpackJsonpentropy-messenger"]=this["webpackJsonpentropy-messenger"]||[]).push([[0],{146:function(e,t,a){e.exports=a(164)},151:function(e,t,a){},152:function(e,t,a){},158:function(e,t,a){},159:function(e,t,a){},164:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),o=a(51),r=a.n(o),i=(a(151),a(9)),s=(a(152),a(180)),u=a(179),l=a(177),d=a(165),m=function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),o=a[0],r=a[1];return Object(n.useEffect)((function(){switch(e.chat.type){case"private":var t=e.chat.users.filter((function(t){return t.id!==e.user}));e.db.collection("users").doc(t[0].id).get().then((function(e){r(e.data().name)}));break;case"group":r(e.chat.title)}}),[e.chat,e.db,e.user]),c.a.createElement(s.a.Item,{name:o,onClick:function(){e.setActiveChat(e.chat.chatID)},active:e.chat.chatID===e.activeChat})},f=a(182),h=a(183),b=(a(82),a(185)),p=function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),o=a[0],r=a[1];return c.a.createElement(f.a,{open:e.addContactOpen},c.a.createElement(f.a.Header,null,"Add Contact:"),c.a.createElement(f.a.Content,null,c.a.createElement(u.a,{onSubmit:function(){!function(t){e.db.collection("users").where("email","==",t).get().then((function(t){t.empty||e.db.collection("users").doc(t.docs[0].id).set({addrequests:t.docs[0].data().addrequests.concat(e.db.collection("users").doc(e.user))},{merge:!0})})),e.setAddContactOpen(!1)}(o)}},c.a.createElement(b.a,{raised:!0},c.a.createElement(u.a.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"E-mail address",onChange:function(e){r(e.target.value)}}),c.a.createElement(d.a,null,"Send Request"),c.a.createElement(d.a,{onClick:function(){e.setAddContactOpen(!1)}},"Cancel")))))},E=a(83),g=function(e){var t=Object(n.useState)([]),a=Object(i.a)(t,2),o=a[0],r=a[1],s=Object(n.useState)(!1),u=Object(i.a)(s,2),l=u[0],m=u[1];return Object(n.useEffect)((function(){void 0!==e.user&&e.db.collection("users").doc(e.user).get().then((function(e){var t=e.data().contacts.map((function(e){return e.get()}));Promise.all(t).then((function(e){r(e.map((function(e){return{name:e.data().name,id:e.id}})))}))}))}),[e.open]),c.a.createElement(f.a,{open:e.open},c.a.createElement(h.a,{selection:!0},o.map((function(t){return c.a.createElement(h.a.Item,{key:E(),onClick:function(a){!function(t){var a=[],n=e.chats.map((function(t){return e.db.collection("chats").doc(t.chatID).get()}));Promise.all(n).then((function(n){0===(a=n.filter((function(e){return"private"===e.data().type&&e.data().users.some((function(e){return t.id===e.id}))}))).length?e.db.collection("chats").add({type:"private",users:[e.db.doc("/users/"+e.user),e.db.doc("/users/"+t.id)]}).then((function(a){e.db.collection(a.id).add({name:e.name,author:e.db.doc("/users/"+e.user),date:e.dbFunc.Timestamp.now(),content:"This is the first message."}),e.db.collection("users").doc(e.user).set({chats:e.chatIDs.concat(a.id)},{merge:!0}),e.db.collection("users").doc(t.id).set({chats:e.chatIDs.concat(a.id)},{merge:!0})})):(e.setActiveChat(a[0].id),e.setOpenContacts(!1))}))}(t)}},t.name)}))),c.a.createElement(d.a,{onClick:function(){e.setOpenContacts(!1)}},"Dismiss"),c.a.createElement(d.a,{onClick:function(){m(!0)}},"Add Contact"),c.a.createElement(p,{db:e.db,user:e.user,addContactOpen:l,setAddContactOpen:m}))},v=(a(158),a(83)),O=function(e){var t=Object(n.useState)(!1),a=Object(i.a)(t,2),o=a[0],r=a[1];return c.a.createElement(s.a,{secondary:!0,vertical:!0},e.chats.map((function(t){return c.a.createElement(m,{chat:t,db:e.db,user:e.user,setActiveChat:e.setActiveChat,activeChat:e.activeChat,key:v()})})),c.a.createElement(u.a,{onSubmit:function(t){e.db.collection("chats").add({title:t.target.title.value,type:"group",users:[e.db.doc("/users/"+e.user)]}).then((function(t){e.db.collection(t.id).add({name:e.name,author:e.db.doc("/users/"+e.user),date:e.dbFunc.Timestamp.now(),content:"This is the first message."}),e.db.collection("users").doc(e.user).set({chats:e.chatIDs.concat(t.id)},{merge:!0})}))}},c.a.createElement(l.a,{id:"title",name:"title",placeholder:"Group Name"}),c.a.createElement(d.a,{type:"submit",floated:"left"},"New Group")),c.a.createElement(d.a,{onClick:function(){r(!0)}},"Contacts"),c.a.createElement(g,{open:o,db:e.db,user:e.user,setOpenContacts:r,chats:e.chats,setActiveChat:e.setActiveChat,dbFunc:e.dbFunc,name:e.name,chatIDs:e.chatIDs}))},C=a(178),j=(a(159),a(181)),S=function(e){return c.a.createElement(j.a,null,c.a.createElement(j.a.Content,null,c.a.createElement(j.a.Author,{as:"a"},e.data.name),c.a.createElement(j.a.Metadata,null,c.a.createElement("div",null,e.data.date.toDate().getHours()+":"+e.data.date.toDate().getMinutes())),c.a.createElement(j.a.Text,null,e.data.content)))},y=a(83),w=function(e){var t=Object(n.useState)([]),a=Object(i.a)(t,2),o=a[0],r=a[1];return Object(n.useEffect)((function(){void 0!==e.activeChat&&null!==e.activeChat&&e.db.collection(e.activeChat).orderBy("date","asc").onSnapshot((function(e){var t=e.docs.map((function(e){return e.data()}));Promise.resolve().then((function(){r(t)}))}))}),[e.activeChat,e.db]),c.a.createElement(j.a.Group,null,o.map((function(t){return c.a.createElement(S,{key:y(),data:t,db:e.db})})))},A=function(e){return c.a.createElement("div",null,c.a.createElement(w,{db:e.db,activeChat:e.activeChat}),c.a.createElement(u.a,{onSubmit:function(t){t.preventDefault(),e.db.collection(e.activeChat).add({name:e.name,author:e.db.doc("/users/"+e.user),date:e.dbFunc.Timestamp.now(),content:t.target.reply.value}).catch((function(e){console.error("Error adding document: ",e)})).then((function(){t.target.reply.value=""}))}},c.a.createElement(C.a,{id:"reply",name:"reply",placeholder:"Reply"}),c.a.createElement(d.a,{type:"submit",floated:"right"},"Send")))},k=a(184),I=a(36),P=(a(129),function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),o=a[0],r=a[1],s=Object(n.useState)(),l=Object(i.a)(s,2),m=l[0],h=l[1],p=Object(n.useState)(),E=Object(i.a)(p,2),g=E[0],v=E[1],O=Object(n.useState)(!1),C=Object(i.a)(O,2),j=C[0],S=C[1],y=Object(n.useState)(),w=Object(i.a)(y,2),A=w[0],P=w[1],D=Object(n.useState)(),q=Object(i.a)(D,2),R=q[0],G=q[1];return c.a.createElement(f.a,{size:"tiny",open:e.open},c.a.createElement(f.a.Content,null,c.a.createElement(u.a,{onSubmit:function(){return function(t,a){I.auth().createUserWithEmailAndPassword(t,a).then((function(t){e.db.collection("users").doc(t.user.uid).set({name:m,email:t.user.email,chats:[],contacts:[],activeChat:null},{merge:!1}),e.setNewUser(!1),S(!1)})).catch((function(e){S(!0),P(e.code),G(e.message)}))}(o,g)},error:j},c.a.createElement(b.a,{raised:!0},c.a.createElement(u.a.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"E-mail address",onChange:function(e){r(e.target.value)}}),c.a.createElement(u.a.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"User Name",onChange:function(e){h(e.target.value)}}),c.a.createElement(u.a.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password",type:"password",onChange:function(e){v(e.target.value)}}),c.a.createElement(k.a,{error:!0,header:A,content:R}),c.a.createElement(d.a,{color:"teal",fluid:!0,size:"large"},"Sign Up"))),c.a.createElement(k.a,{onClick:function(){e.setNewUser(!1)}},"Go back")))}),D=function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),o=a[0],r=a[1],s=Object(n.useState)(),l=Object(i.a)(s,2),m=l[0],h=l[1],p=Object(n.useState)(!1),E=Object(i.a)(p,2),g=E[0],v=E[1];return c.a.createElement(f.a,{size:"tiny",open:e.open},c.a.createElement(f.a.Header,null,"Welcome to Entropy. Please log in:"),c.a.createElement(f.a.Content,null,c.a.createElement(u.a,{onSubmit:function(){return e.loginSubmit(o,m)},error:e.loginError},c.a.createElement(b.a,{raised:!0},c.a.createElement(u.a.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"E-mail address",onChange:function(e){r(e.target.value)}}),c.a.createElement(u.a.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password",type:"password",onChange:function(e){h(e.target.value)}}),c.a.createElement(k.a,{error:!0,header:e.loginErrorCode,content:e.loginErrorMessage}),c.a.createElement(d.a,{color:"teal",fluid:!0,size:"large"},"Login"))),c.a.createElement(b.a,{raised:!0},c.a.createElement(d.a,{color:"teal",fluid:!0,size:"large",onClick:e.googleLoginSubmit},"Login with Google")),c.a.createElement(k.a,null,"Don't have an account?"," ",c.a.createElement("a",{onClick:function(){v(!0)}},"Sign Up"),c.a.createElement(P,{open:g,db:e.db,setNewUser:v}))))},q=a(83),R=function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),o=a[0],r=a[1];return Object(n.useEffect)((function(){void 0!==e.user&&e.db.collection("users").doc(e.user).set({addrequests:e.addRequests.map((function(t){return e.db.collection("users").doc(t.id)}))},{merge:!0})}),[e.addRequests]),c.a.createElement(f.a,{open:e.approveAddOpen},c.a.createElement(h.a,{selection:!0},e.addRequests.map((function(e){return c.a.createElement(h.a.Item,{key:q(),id:e.id,onClick:function(t){r(e)}},e.data().name)}))),c.a.createElement(d.a,{onClick:function(){var t;t=o,e.db.collection("users").doc(e.user).get().then((function(a){var n=a.data().contacts.map((function(e){return e.get()}));Promise.all(n).then((function(a){e.db.collection("users").doc(e.user).set({contacts:a.concat(t).map((function(e){return e.ref}))},{merge:!0})})),e.setAddRequests(e.addRequests.filter((function(e){return e.id!==t.id})))}))}},"Approve"),c.a.createElement(d.a,{onClick:function(){var t;t=o,e.setAddRequests(e.addRequests.filter((function(e){return e.id!==t.id})))}},"Reject"),c.a.createElement(d.a,{onClick:function(){e.setApproveAddOpen(!1)}},"Dismiss"))},G=a(186);a(161);I.initializeApp({apiKey:"AIzaSyCiemC3RJx8s3kHs4Y2SasrhG_epoQjEDw",authDomain:"entropy-messenger.firebaseapp.com",databaseURL:"https://entropy-messenger.firebaseio.com",projectId:"entropy-messenger",storageBucket:"entropy-messenger.appspot.com",messagingSenderId:"739103714260",appId:"1:739103714260:web:9f34197363bb3b2e4dc441",measurementId:"G-WNTGXPFSRH"});var N=I.firestore(),F=I.firestore,U=function(){var e=Object(n.useState)(),t=Object(i.a)(e,2),a=t[0],o=t[1],r=Object(n.useState)(),s=Object(i.a)(r,2),l=s[0],m=s[1],f=Object(n.useState)([]),h=Object(i.a)(f,2),b=h[0],p=h[1],E=Object(n.useState)([]),g=Object(i.a)(E,2),v=g[0],C=g[1],j=Object(n.useState)(),S=Object(i.a)(j,2),y=S[0],w=S[1],k=Object(n.useState)(!0),P=Object(i.a)(k,2),q=P[0],U=P[1],z=Object(n.useState)(!1),T=Object(i.a)(z,2),W=T[0],H=T[1],L=Object(n.useState)(""),M=Object(i.a)(L,2),x=M[0],B=M[1],J=Object(n.useState)(""),K=Object(i.a)(J,2),Q=K[0],X=K[1],Y=Object(n.useState)(!1),$=Object(i.a)(Y,2),_=$[0],V=$[1],Z=Object(n.useState)([]),ee=Object(i.a)(Z,2),te=ee[0],ae=ee[1];Object(n.useEffect)((function(){void 0!==a&&N.collection("users").doc(a).get().then((function(e){w(e.data().activeChat),C(e.data().chats);var t=e.data().chats.map((function(e){return N.collection("chats").doc(e).get()}));Promise.all(t).then((function(e){p(e.map((function(e){return{title:e.data().title,type:e.data().type,users:e.data().users,chatID:e.id}})))})),ne(a)}))}),[a]);var ne=function(e){N.collection("users").doc(e).onSnapshot((function(e){if(e.data().addrequests.length>0){var t=e.data().addrequests.map((function(e){return e.get()}));Promise.all(t).then((function(e){ae(e)})),V(!0)}}))};return c.a.createElement(G.a,null,c.a.createElement(G.a.Column,{width:3},c.a.createElement(O,{db:N,dbFunc:F,user:a,name:l,chats:b,chatIDs:v,setActiveChat:function(e){w(e)},activeChat:y})),c.a.createElement(G.a.Column,{width:4},c.a.createElement(A,{db:N,dbFunc:F,user:a,name:l,activeChat:y})),c.a.createElement(G.a.Column,{width:4},c.a.createElement(u.a,{onSubmit:function(){}},c.a.createElement(d.a,{type:"submit",floated:"left"},"Add Person to Chat"))),c.a.createElement(D,{open:q,loginSubmit:function(e,t){I.auth().signInWithEmailAndPassword(e,t).then((function(e){o(e.user.uid),N.collection("users").doc(e.user.uid).get().then((function(e){m(e.data().name)}))})).then((function(){U(!1),H(!1)})).catch((function(e){H(!0),B(e.code),X(e.message)}))},googleLoginSubmit:function(){var e=new I.auth.GoogleAuthProvider;I.auth().signInWithPopup(e).then((function(e){N.collection("users").doc(e.user.uid).get().then((function(t){t.exists?(o(e.user.uid),m(e.user.displayName)):N.collection("users").doc(e.user.uid).set({name:e.user.displayName,email:e.user.email,chats:[],contacts:[],activeChat:null},{merge:!1})})).then((function(){U(!1),H(!1)}))}))},db:N,loginError:W,loginErrorCode:x,loginErrorMessage:Q}),c.a.createElement(R,{db:N,user:a,approveAddOpen:_,setApproveAddOpen:V,addRequests:te,setAddRequests:ae}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(U,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[146,1,2]]]);
//# sourceMappingURL=main.b24f8831.chunk.js.map