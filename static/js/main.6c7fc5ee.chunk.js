(this["webpackJsonpentropy-messenger"]=this["webpackJsonpentropy-messenger"]||[]).push([[0],{138:function(e,t,a){e.exports=a(158)},143:function(e,t,a){},144:function(e,t,a){},147:function(e,t,a){},151:function(e,t,a){},158:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(47),o=a.n(r),i=(a(143),a(28)),s=(a(144),a(175)),u=a(174),l=a(172),d=a(159),m=a(108),h=function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),r=a[0],o=a[1];return Object(n.useEffect)((function(){switch(e.chat.type){case"private":var t=e.chat.users.filter((function(t){return t.id!==e.user}));e.db.collection("users").doc(t[0].id).get().then((function(e){o(e.data().name)}));break;case"group":o(e.chat.title)}}),[e.chat]),c.a.createElement(s.a.Item,{key:m(),name:r,onClick:function(){e.setActiveChat(e.chat.chatID)},active:e.chat.chatID===e.activeChat})},p=(a(147),function(e){return c.a.createElement(s.a,{secondary:!0,vertical:!0},e.chats.map((function(t){return c.a.createElement(h,{chat:t,db:e.db,user:e.user,setActiveChat:e.setActiveChat,activeChat:e.activeChat})})),c.a.createElement(u.a,{onSubmit:function(t){e.db.collection("chats").add({title:t.target.title.value,type:"group",users:[e.db.doc("/users/"+e.user)]}).then((function(t){e.db.collection(t.id).add({name:e.name,author:e.db.doc("/users/"+e.user),date:e.dbFunc.Timestamp.now(),content:"This is the first message."}),e.db.collection("users").doc(e.user).set({chats:e.chatIDs.concat(t.id)},{merge:!0})}))}},c.a.createElement(l.a,{id:"title",name:"title",placeholder:"Group Name"}),c.a.createElement(d.a,{type:"submit",floated:"left"},"New Group")))}),f=a(173),b=(a(151),a(176)),v=function(e){return c.a.createElement(b.a,null,c.a.createElement(b.a.Content,null,c.a.createElement(b.a.Author,{as:"a"},e.data.name),c.a.createElement(b.a.Metadata,null,c.a.createElement("div",null,e.data.date.toDate().getHours()+":"+e.data.date.toDate().getMinutes())),c.a.createElement(b.a.Text,null,e.data.content)))},g=a(108),E=function(e){var t=Object(n.useState)([]),a=Object(i.a)(t,2),r=a[0],o=a[1];return Object(n.useEffect)((function(){(console.log("props.activeChat: ",e.activeChat),void 0!==e.activeChat)&&e.db.collection(e.activeChat).orderBy("date","asc").onSnapshot((function(e){var t=e.docs.map((function(e){return e.data()}));Promise.resolve().then((function(){o(t)}))}))}),[e.activeChat]),c.a.createElement(b.a.Group,null,r.map((function(t){return c.a.createElement(v,{key:g(),data:t,db:e.db})})))},y=function(e){return c.a.createElement("div",null,c.a.createElement(E,{db:e.db,activeChat:e.activeChat}),c.a.createElement(u.a,{onSubmit:function(t){t.preventDefault(),e.db.collection(e.activeChat).add({name:e.name,author:e.db.doc("/users/"+e.user),date:e.dbFunc.Timestamp.now(),content:t.target.reply.value}).catch((function(e){console.error("Error adding document: ",e)})).then((function(){t.target.reply.value=""}))}},c.a.createElement(f.a,{id:"reply",name:"reply",placeholder:"Reply"}),c.a.createElement(d.a,{type:"submit",floated:"right"},"Send")))},C=(a(152),a(177)),j=a(71);a(153),a(155),a(108);j.initializeApp({apiKey:"AIzaSyCiemC3RJx8s3kHs4Y2SasrhG_epoQjEDw",authDomain:"entropy-messenger.firebaseapp.com",databaseURL:"https://entropy-messenger.firebaseio.com",projectId:"entropy-messenger",storageBucket:"entropy-messenger.appspot.com",messagingSenderId:"739103714260",appId:"1:739103714260:web:9f34197363bb3b2e4dc441",measurementId:"G-WNTGXPFSRH"});var O=j.firestore(),w=j.firestore,S=function(){var e=Object(n.useState)(),t=Object(i.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)(),s=Object(i.a)(o,2),u=s[0],l=s[1],d=Object(n.useState)([]),m=Object(i.a)(d,2),h=m[0],f=m[1],b=Object(n.useState)([]),v=Object(i.a)(b,2),g=v[0],E=v[1],S=Object(n.useState)(),I=Object(i.a)(S,2),k=I[0],D=I[1];Object(n.useEffect)((function(){var e=new j.auth.GoogleAuthProvider;j.auth().signInWithPopup(e).then((function(e){O.collection("users").doc(e.user.uid).get().then((function(t){t.exists?(r(e.user.uid),l(e.user.displayName)):O.collection("users").doc(e.user.uid).set({name:e.user.displayName,email:e.user.email,chats:[],contacts:[],activeChat:null},{merge:!1})}))}))}),[]),Object(n.useEffect)((function(){void 0!==a&&O.collection("users").doc(a).get().then((function(e){D(e.data().activeChat),E(e.data().chats);var t=e.data().chats.map((function(e){return O.collection("chats").doc(e).get()}));Promise.all(t).then((function(e){f(e.map((function(e){return{title:e.data().title,type:e.data().type,users:e.data().users,chatID:e.id}})))}))}))}),[a]);return c.a.createElement(C.a,null,c.a.createElement(C.a.Column,{width:3},c.a.createElement(p,{db:O,dbFunc:w,user:a,name:u,chats:h,chatIDs:g,setActiveChat:function(e){console.log("setActiveChat: ",e),D(e)},activeChat:k})),c.a.createElement(C.a.Column,{width:4},c.a.createElement(y,{db:O,dbFunc:w,user:a,name:u,activeChat:k})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[138,1,2]]]);
//# sourceMappingURL=main.6c7fc5ee.chunk.js.map